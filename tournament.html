<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR CST - 더블 엘리미네이션 토너먼트</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Inter:wght@400;600;700;900&family=Poppins:ital,wght@0,400;0,600;0,700;1,900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Color Palette - index.html과 동일 */
            --primary-red: #ef5a6f;
            --primary-blue: #536493;
            --dark-bg: #1a1f2e;
            --dark-bg-light: #2c3547;
            --neon-pink: #ff4d6d;
            --neon-purple: #c77dff;
            --white: #ffffff;
            --gray-light: #e1e5f2;
            --gray-medium: #8892b0;
            --gray-dark: #495057;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            
            /* Gradients */
            --gradient-red-blue: linear-gradient(135deg, #ef5a6f 0%, #536493 100%);
            --gradient-neon: linear-gradient(135deg, #ff4d6d 0%, #c77dff 100%);
            --gradient-dark: linear-gradient(180deg, #1a1f2e 0%, #2c3547 100%);
            --gradient-winner: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            --gradient-loser: linear-gradient(135deg, #536493 0%, #8892b0 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Gowun Dodum', 'Inter', 'Segoe UI', sans-serif;
            background: var(--dark-bg);
            min-height: 100vh;
            padding: 20px;
            color: var(--white);
            position: relative;
            overflow-x: hidden;
        }

        /* 배경 효과 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-dark);
            z-index: -2;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(239, 90, 111, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(83, 100, 147, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 50% 20%, rgba(199, 125, 255, 0.05) 0%, transparent 50%);
            z-index: -1;
            animation: floatingGradient 20s ease-in-out infinite;
        }

        @keyframes floatingGradient {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(-20px, -20px) scale(1.1); }
            66% { transform: translate(20px, -10px) scale(0.95); }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* 헤더 */
        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease;
            position: relative;
            padding: 40px 0;
        }

        .header h1 {
            font-size: 4em;
            font-family: 'Poppins', sans-serif;
            font-weight: 900;
            font-style: italic;
            margin-bottom: 15px;
            background: var(--gradient-red-blue);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(239, 90, 111, 0.3);
            letter-spacing: -2px;
            position: relative;
        }

        .header .subtitle {
            font-size: 1.5em;
            color: var(--gray-light);
            font-weight: 400;
            letter-spacing: 2px;
            margin-top: 10px;
            text-transform: uppercase;
            opacity: 0.9;
        }

        /* 네비게이션 */
        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .btn {
            background: var(--gradient-red-blue);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(239, 90, 111, 0.3);
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 90, 111, 0.4);
        }

        .btn-secondary {
            background: rgba(83, 100, 147, 0.8);
            box-shadow: 0 4px 15px rgba(83, 100, 147, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(83, 100, 147, 0.4);
        }

        /* 토너먼트 정보 */
        .tournament-info {
            background: rgba(44, 53, 71, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(239, 90, 111, 0.3);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .tournament-info h2 {
            color: var(--neon-pink);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .rule-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid var(--neon-pink);
        }

        .rule-card h3 {
            color: var(--neon-purple);
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        /* 팀 현황 */
        .teams-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .team-card {
            background: rgba(44, 53, 71, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(83, 100, 147, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(83, 100, 147, 0.3);
        }

        .team-card h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .team-alpha { border-color: #ff6b6b; }
        .team-bravo { border-color: #4ecdc4; }
        .team-charlie { border-color: #45b7d1; }
        .team-delta { border-color: #f9ca24; }

        .team-status {
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            display: inline-block;
        }

        .status-winner { background: var(--gradient-winner); color: var(--dark-bg); }
        .status-loser { background: var(--gradient-loser); }
        .status-eliminated { background: rgba(255, 255, 255, 0.1); opacity: 0.5; }

        /* 대진표 */
        .bracket-container {
            background: rgba(44, 53, 71, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(239, 90, 111, 0.2);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .bracket-title {
            color: var(--neon-pink);
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .bracket {
            display: flex;
            justify-content: space-around;
            align-items: center;
            min-width: 800px;
            margin: 20px 0;
        }

        .round {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .match {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            min-width: 150px;
            position: relative;
        }

        .match-header {
            font-size: 0.9em;
            color: var(--gray-medium);
            margin-bottom: 10px;
            text-align: center;
        }

        .match-teams {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .match-team {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .match-team:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .match-team.winner {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid var(--gold);
        }

        .match-team.loser {
            opacity: 0.5;
        }

        .score-input {
            width: 50px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            color: white;
            text-align: center;
        }

        /* 경기 컨트롤 */
        .match-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-small {
            padding: 5px 15px;
            font-size: 0.9em;
            border-radius: 15px;
        }

        /* 챔피언 섹션 */
        .champion-section {
            background: var(--gradient-winner);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-top: 30px;
            display: none;
            animation: championReveal 1s ease;
        }

        .champion-section.show {
            display: block;
        }

        @keyframes championReveal {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .champion-title {
            color: var(--dark-bg);
            font-size: 3em;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* 애니메이션 */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Victory Modal */
        .victory-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            z-index: 1000;
            animation: victoryFadeIn 0.5s ease;
        }

        .victory-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .victory-modal-content {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 40px;
            text-align: center;
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: victorySlideIn 0.6s ease;
        }

        /* Close button removed - auto close after 10 seconds */

        .victory-title {
            font-size: 9em;
            margin-bottom: 50px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: victoryPulse 2s infinite;
            text-shadow: 0 0 80px rgba(255, 215, 0, 0.8);
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.6));
        }

        .victory-team-image {
            margin: 40px 0;
            animation: victoryGlow 3s infinite;
        }

        .victory-team-image img {
            width: 450px;
            height: 450px;
            border-radius: 50%;
            border: 15px solid var(--gold);
            box-shadow: 0 0 100px var(--gold), 0 0 150px rgba(255, 215, 0, 0.5), 0 0 200px rgba(255, 215, 0, 0.3);
            object-fit: cover;
        }

        .victory-team-name {
            font-size: 7em;
            margin: 40px 0;
            color: var(--white);
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5), 4px 4px 8px rgba(0, 0, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.5);
            font-weight: 900;
            letter-spacing: 3px;
        }

        .victory-message {
            font-size: 4em;
            color: #ffffff;
            margin: 30px 0;
            font-weight: 700;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.4), 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .victory-celebration {
            margin-top: 50px;
        }

        .celebration-text {
            font-size: 3.5em;
            color: #ff4d6d;
            animation: victoryBounce 1s infinite;
            text-shadow: 0 0 30px rgba(255, 77, 109, 0.8), 0 0 50px rgba(199, 125, 255, 0.4);
            font-weight: 700;
        }
        
        .victory-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Confetti Canvas */
        .confetti-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* Victory Animations */
        @keyframes victoryFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes victorySlideIn {
            from {
                opacity: 0;
                transform: scale(0.3) translateY(-100px);
            }
            50% {
                transform: scale(1.05) translateY(0);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes victoryPulse {
            0%, 100% { 
                transform: scale(1);
                filter: brightness(1);
            }
            50% { 
                transform: scale(1.08);
                filter: brightness(1.2);
            }
        }

        @keyframes victoryGlow {
            0%, 100% { 
                filter: drop-shadow(0 0 40px var(--gold));
                transform: scale(1) rotate(0deg);
            }
            50% { 
                filter: drop-shadow(0 0 80px var(--gold));
                transform: scale(1.05) rotate(5deg);
            }
        }

        @keyframes victoryBounce {
            0%, 20%, 50%, 80%, 100% { 
                transform: translateY(0) scale(1);
            }
            40% { 
                transform: translateY(-20px) scale(1.1);
            }
            60% { 
                transform: translateY(-10px) scale(1.05);
            }
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }

            .bracket-container {
                padding: 15px;
            }

            .rules-grid {
                grid-template-columns: 1fr;
            }

            .teams-status {
                grid-template-columns: repeat(2, 1fr);
            }

            .victory-modal-content {
                padding: 20px;
                width: 100%;
                height: 100vh;
            }

            .victory-title {
                font-size: 3.5em;
            }

            .victory-team-image img {
                width: 200px;
                height: 200px;
            }

            .victory-team-name {
                font-size: 3em;
            }
            
            .victory-message {
                font-size: 1.8em;
            }
            
            .celebration-text {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VR CST</h1>
            <div class="subtitle">더블 엘리미네이션 토너먼트</div>
        </div>

        <div class="navigation">
            <a href="index.html" class="btn btn-secondary">🏠 경매 페이지로</a>
            <button class="btn" onclick="resetTournament()">🔄 토너먼트 초기화</button>
            <button class="btn btn-secondary" onclick="exportResults()">📥 결과 내보내기</button>
        </div>

        <div class="tournament-info">
            <h2>📋 토너먼트 규칙</h2>
            <div class="rules-grid">
                <div class="rule-card">
                    <h3>🏆 더블 엘리미네이션</h3>
                    <p>모든 팀은 2번의 패배 기회가 있습니다. 첫 패배시 패자조로 이동, 두 번째 패배시 탈락합니다.</p>
                </div>
                <div class="rule-card">
                    <h3>⚔️ 승자조 (Winner's Bracket)</h3>
                    <p>패배하지 않은 팀들의 대진. 여기서 패배시 패자조로 이동합니다.</p>
                </div>
                <div class="rule-card">
                    <h3>🛡️ 패자조 (Loser's Bracket)</h3>
                    <p>한 번 패배한 팀들의 대진. 여기서 패배시 완전히 탈락합니다.</p>
                </div>
                <div class="rule-card">
                    <h3>👑 그랜드 파이널</h3>
                    <p>승자조 우승팀과 패자조 우승팀이 맞붙는 단판 승부! 승자가 최종 챔피언이 됩니다!</p>
                </div>
            </div>
        </div>

        <div class="teams-status" id="teamsStatus">
            <div class="team-card team-alpha">
                <h3>Team Alpha</h3>
                <div class="team-record">전적: <span id="alphaRecord">0승 0패</span></div>
                <div class="team-status status-winner" id="alphaStatus">승자조</div>
            </div>
            <div class="team-card team-bravo">
                <h3>Team Bravo</h3>
                <div class="team-record">전적: <span id="bravoRecord">0승 0패</span></div>
                <div class="team-status status-winner" id="bravoStatus">승자조</div>
            </div>
            <div class="team-card team-charlie">
                <h3>Team Charlie</h3>
                <div class="team-record">전적: <span id="charlieRecord">0승 0패</span></div>
                <div class="team-status status-winner" id="charlieStatus">승자조</div>
            </div>
            <div class="team-card team-delta">
                <h3>Team Delta</h3>
                <div class="team-record">전적: <span id="deltaRecord">0승 0패</span></div>
                <div class="team-status status-winner" id="deltaStatus">승자조</div>
            </div>
        </div>

        <!-- 승자조 대진표 -->
        <div class="bracket-container">
            <h2 class="bracket-title">🏆 승자조 (Winner's Bracket)</h2>
            <div class="bracket" id="winnersBracket">
                <!-- 라운드 1 -->
                <div class="round">
                    <div class="match" id="wb-match1">
                        <div class="match-header">준결승 1</div>
                        <div class="match-teams">
                            <div class="match-team" onclick="selectWinner('wb-match1', 0)">
                                <span id="wb-match1-team1">Team Alpha</span>
                                <input type="number" class="score-input" id="wb-match1-score1" min="0" value="0">
                            </div>
                            <div class="match-team" onclick="selectWinner('wb-match1', 1)">
                                <span id="wb-match1-team2">Team Bravo</span>
                                <input type="number" class="score-input" id="wb-match1-score2" min="0" value="0">
                            </div>
                        </div>
                        <div class="match-controls">
                            <button class="btn btn-small" onclick="confirmMatch('wb-match1')">결과 확정</button>
                        </div>
                    </div>
                    <div class="match" id="wb-match2">
                        <div class="match-header">준결승 2</div>
                        <div class="match-teams">
                            <div class="match-team" onclick="selectWinner('wb-match2', 0)">
                                <span id="wb-match2-team1">Team Charlie</span>
                                <input type="number" class="score-input" id="wb-match2-score1" min="0" value="0">
                            </div>
                            <div class="match-team" onclick="selectWinner('wb-match2', 1)">
                                <span id="wb-match2-team2">Team Delta</span>
                                <input type="number" class="score-input" id="wb-match2-score2" min="0" value="0">
                            </div>
                        </div>
                        <div class="match-controls">
                            <button class="btn btn-small" onclick="confirmMatch('wb-match2')">결과 확정</button>
                        </div>
                    </div>
                </div>

                <!-- 라운드 2 (결승) -->
                <div class="round">
                    <div class="match" id="wb-final">
                        <div class="match-header">승자조 결승</div>
                        <div class="match-teams">
                            <div class="match-team" onclick="selectWinner('wb-final', 0)">
                                <span id="wb-final-team1">대기중...</span>
                                <input type="number" class="score-input" id="wb-final-score1" min="0" value="0" disabled>
                            </div>
                            <div class="match-team" onclick="selectWinner('wb-final', 1)">
                                <span id="wb-final-team2">대기중...</span>
                                <input type="number" class="score-input" id="wb-final-score2" min="0" value="0" disabled>
                            </div>
                        </div>
                        <div class="match-controls">
                            <button class="btn btn-small" onclick="confirmMatch('wb-final')" disabled>결과 확정</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 패자조 대진표 -->
        <div class="bracket-container">
            <h2 class="bracket-title">🛡️ 패자조 (Loser's Bracket)</h2>
            <div class="bracket" id="losersBracket">
                <div class="round">
                    <div class="match" id="lb-match1">
                        <div class="match-header">패자조 준결승</div>
                        <div class="match-teams">
                            <div class="match-team" onclick="selectWinner('lb-match1', 0)">
                                <span id="lb-match1-team1">대기중...</span>
                                <input type="number" class="score-input" id="lb-match1-score1" min="0" value="0" disabled>
                            </div>
                            <div class="match-team" onclick="selectWinner('lb-match1', 1)">
                                <span id="lb-match1-team2">대기중...</span>
                                <input type="number" class="score-input" id="lb-match1-score2" min="0" value="0" disabled>
                            </div>
                        </div>
                        <div class="match-controls">
                            <button class="btn btn-small" onclick="confirmMatch('lb-match1')" disabled>결과 확정</button>
                        </div>
                    </div>
                </div>

                <div class="round">
                    <div class="match" id="lb-final">
                        <div class="match-header">패자조 결승</div>
                        <div class="match-teams">
                            <div class="match-team" onclick="selectWinner('lb-final', 0)">
                                <span id="lb-final-team1">대기중...</span>
                                <input type="number" class="score-input" id="lb-final-score1" min="0" value="0" disabled>
                            </div>
                            <div class="match-team" onclick="selectWinner('lb-final', 1)">
                                <span id="lb-final-team2">대기중...</span>
                                <input type="number" class="score-input" id="lb-final-score2" min="0" value="0" disabled>
                            </div>
                        </div>
                        <div class="match-controls">
                            <button class="btn btn-small" onclick="confirmMatch('lb-final')" disabled>결과 확정</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 그랜드 파이널 -->
        <div class="bracket-container">
            <h2 class="bracket-title">👑 그랜드 파이널</h2>
            <div class="bracket" id="grandFinal">
                <div class="round">
                    <div class="match" id="gf-match1">
                        <div class="match-header">그랜드 파이널</div>
                        <div class="match-teams">
                            <div class="match-team" onclick="selectWinner('gf-match1', 0)">
                                <span id="gf-match1-team1">승자조 우승팀</span>
                                <input type="number" class="score-input" id="gf-match1-score1" min="0" value="0" disabled>
                            </div>
                            <div class="match-team" onclick="selectWinner('gf-match1', 1)">
                                <span id="gf-match1-team2">패자조 우승팀</span>
                                <input type="number" class="score-input" id="gf-match1-score2" min="0" value="0" disabled>
                            </div>
                        </div>
                        <div class="match-controls">
                            <button class="btn btn-small" onclick="confirmMatch('gf-match1')" disabled>결과 확정</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- 챔피언 섹션 -->
        <div class="champion-section" id="championSection">
            <h2 class="champion-title">🏆 최종 우승팀 🏆</h2>
            <h1 id="championTeam" style="color: var(--dark-bg); font-size: 2.5em; margin: 20px 0;"></h1>
            <p style="color: var(--dark-bg); font-size: 1.2em;">축하합니다! VR CST 챔피언!</p>
        </div>
    </div>

    <!-- Victory Modal -->
    <div id="victoryModal" class="victory-modal">
        <div class="victory-modal-content">
            <div class="victory-content">
                <h1 class="victory-title">🏆 우승! 🏆</h1>
                <div class="victory-team-image">
                    <img id="victoryTeamImage" src="" alt="Team Image">
                </div>
                <h2 id="victoryTeamName" class="victory-team-name"></h2>
                <p class="victory-message">VR CST 챔피언!</p>
                <div class="victory-celebration">
                    <span class="celebration-text">축하합니다!</span>
                </div>
            </div>
        </div>
        <canvas id="confettiCanvas" class="confetti-canvas"></canvas>
    </div>

    <script>
        // 토너먼트 상태 관리
        let tournamentState = {
            teams: {
                alpha: { name: 'Team Alpha', wins: 0, losses: 0, status: 'winner', color: '#ff6b6b' },
                bravo: { name: 'Team Bravo', wins: 0, losses: 0, status: 'winner', color: '#4ecdc4' },
                charlie: { name: 'Team Charlie', wins: 0, losses: 0, status: 'winner', color: '#45b7d1' },
                delta: { name: 'Team Delta', wins: 0, losses: 0, status: 'winner', color: '#f9ca24' }
            },
            matches: {},
            currentRound: 'wb-semis',
            champion: null
        };

        // LocalStorage에서 상태 로드
        function loadState() {
            const saved = localStorage.getItem('tournamentState');
            if (saved) {
                tournamentState = JSON.parse(saved);
                updateUI();
            }
        }

        // LocalStorage에 상태 저장
        function saveState() {
            localStorage.setItem('tournamentState', JSON.stringify(tournamentState));
        }

        // UI 업데이트
        function updateUI() {
            // 팀 상태 업데이트
            Object.keys(tournamentState.teams).forEach(teamKey => {
                const team = tournamentState.teams[teamKey];
                const recordEl = document.getElementById(`${teamKey}Record`);
                const statusEl = document.getElementById(`${teamKey}Status`);
                
                if (recordEl) {
                    recordEl.textContent = `${team.wins}승 ${team.losses}패`;
                }
                
                if (statusEl) {
                    if (team.status === 'winner') {
                        statusEl.textContent = '승자조';
                        statusEl.className = 'team-status status-winner';
                    } else if (team.status === 'loser') {
                        statusEl.textContent = '패자조';
                        statusEl.className = 'team-status status-loser';
                    } else if (team.status === 'eliminated') {
                        statusEl.textContent = '탈락';
                        statusEl.className = 'team-status status-eliminated';
                    } else if (team.status === 'champion') {
                        statusEl.textContent = '🏆 챔피언';
                        statusEl.className = 'team-status status-winner';
                    }
                }
            });

            // 경기 결과 업데이트
            Object.keys(tournamentState.matches).forEach(matchId => {
                const match = tournamentState.matches[matchId];
                if (match.completed) {
                    // 승자/패자 표시
                    const team1El = document.querySelector(`#${matchId} .match-team:nth-child(1)`);
                    const team2El = document.querySelector(`#${matchId} .match-team:nth-child(2)`);
                    
                    if (match.winner === 0) {
                        team1El?.classList.add('winner');
                        team2El?.classList.add('loser');
                    } else {
                        team2El?.classList.add('winner');
                        team1El?.classList.add('loser');
                    }
                }
            });

            // 챔피언 표시
            if (tournamentState.champion) {
                const championSection = document.getElementById('championSection');
                const championTeam = document.getElementById('championTeam');
                championSection.classList.add('show');
                championTeam.textContent = tournamentState.teams[tournamentState.champion].name;
            }
        }

        // 승자 선택
        function selectWinner(matchId, teamIndex) {
            const match = document.getElementById(matchId);
            const teams = match.querySelectorAll('.match-team');
            
            teams.forEach((team, index) => {
                if (index === teamIndex) {
                    team.classList.add('winner');
                    team.classList.remove('loser');
                } else {
                    team.classList.add('loser');
                    team.classList.remove('winner');
                }
            });
        }

        // 경기 결과 확정
        function confirmMatch(matchId) {
            const score1 = parseInt(document.getElementById(`${matchId}-score1`).value) || 0;
            const score2 = parseInt(document.getElementById(`${matchId}-score2`).value) || 0;
            
            if (score1 === score2) {
                alert('동점일 수 없습니다. 승자를 결정해주세요.');
                return;
            }

            const winner = score1 > score2 ? 0 : 1;
            const team1Name = document.getElementById(`${matchId}-team1`).textContent;
            const team2Name = document.getElementById(`${matchId}-team2`).textContent;

            // 상태 저장
            tournamentState.matches[matchId] = {
                team1: team1Name,
                team2: team2Name,
                score1: score1,
                score2: score2,
                winner: winner,
                completed: true
            };

            // 팀 전적 업데이트
            updateTeamRecords(matchId, team1Name, team2Name, winner);

            // 다음 라운드 진행
            advanceTournament(matchId, winner === 0 ? team1Name : team2Name, winner === 0 ? team2Name : team1Name);

            saveState();
            updateUI();
        }

        // 팀 전적 업데이트
        function updateTeamRecords(matchId, team1Name, team2Name, winner) {
            const team1Key = getTeamKey(team1Name);
            const team2Key = getTeamKey(team2Name);

            if (winner === 0) {
                // Team1 승리
                if (team1Key) tournamentState.teams[team1Key].wins++;
                if (team2Key) {
                    tournamentState.teams[team2Key].losses++;
                    // 패자조에서 패배시 탈락
                    if (matchId.startsWith('lb-') || matchId.startsWith('gf-')) {
                        if (tournamentState.teams[team2Key].losses >= 2) {
                            tournamentState.teams[team2Key].status = 'eliminated';
                        } else {
                            tournamentState.teams[team2Key].status = 'loser';
                        }
                    } else if (matchId.startsWith('wb-')) {
                        // 승자조에서 패배시 패자조로
                        tournamentState.teams[team2Key].status = 'loser';
                    }
                }
            } else {
                // Team2 승리
                if (team2Key) tournamentState.teams[team2Key].wins++;
                if (team1Key) {
                    tournamentState.teams[team1Key].losses++;
                    // 패자조에서 패배시 탈락
                    if (matchId.startsWith('lb-') || matchId.startsWith('gf-')) {
                        if (tournamentState.teams[team1Key].losses >= 2) {
                            tournamentState.teams[team1Key].status = 'eliminated';
                        } else {
                            tournamentState.teams[team1Key].status = 'loser';
                        }
                    } else if (matchId.startsWith('wb-')) {
                        // 승자조에서 패배시 패자조로
                        tournamentState.teams[team1Key].status = 'loser';
                    }
                }
            }
        }

        // 팀 이름으로 키 찾기
        function getTeamKey(teamName) {
            for (let key in tournamentState.teams) {
                if (tournamentState.teams[key].name === teamName) {
                    return key;
                }
            }
            return null;
        }

        // 토너먼트 진행
        function advanceTournament(matchId, winnerName, loserName) {
            // 승자조 준결승 완료 후
            if (matchId === 'wb-match1' || matchId === 'wb-match2') {
                // 패자는 패자조로
                const lbMatch = document.getElementById('lb-match1');
                if (matchId === 'wb-match1') {
                    document.getElementById('lb-match1-team1').textContent = loserName;
                    lbMatch.querySelector('.score-input').disabled = false;
                    lbMatch.querySelector('.btn-small').disabled = false;
                    
                    // 승자는 승자조 결승으로
                    document.getElementById('wb-final-team1').textContent = winnerName;
                } else {
                    document.getElementById('lb-match1-team2').textContent = loserName;
                    
                    // 승자는 승자조 결승으로
                    document.getElementById('wb-final-team2').textContent = winnerName;
                    
                    // 승자조 결승 활성화
                    const wbFinal = document.getElementById('wb-final');
                    wbFinal.querySelectorAll('.score-input').forEach(input => input.disabled = false);
                    wbFinal.querySelector('.btn-small').disabled = false;
                }
            }

            // 승자조 결승 완료 후
            if (matchId === 'wb-final') {
                // 패자는 패자조 결승으로
                document.getElementById('lb-final-team2').textContent = loserName;
                
                // 승자는 그랜드 파이널로
                document.getElementById('gf-match1-team1').textContent = winnerName;
            }

            // 패자조 준결승 완료 후
            if (matchId === 'lb-match1') {
                // 승자는 패자조 결승으로
                document.getElementById('lb-final-team1').textContent = winnerName;
                
                // 패자조 결승 활성화
                const lbFinal = document.getElementById('lb-final');
                lbFinal.querySelectorAll('.score-input').forEach(input => input.disabled = false);
                lbFinal.querySelector('.btn-small').disabled = false;
            }

            // 패자조 결승 완료 후
            if (matchId === 'lb-final') {
                // 승자는 그랜드 파이널로
                document.getElementById('gf-match1-team2').textContent = winnerName;
                
                // 그랜드 파이널 활성화
                const gfMatch1 = document.getElementById('gf-match1');
                gfMatch1.querySelectorAll('.score-input').forEach(input => input.disabled = false);
                gfMatch1.querySelector('.btn-small').disabled = false;
            }

            // 그랜드 파이널 완료 후
            if (matchId === 'gf-match1') {
                const winnerKey = getTeamKey(winnerName);
                tournamentState.champion = winnerKey;
                tournamentState.teams[winnerKey].status = 'champion';
                showVictoryModal(winnerKey);
            }
        }

        // 팀 키를 이미지 경로로 매핑
        const teamImages = {
            alpha: 'images/teams/alpha.png',
            bravo: 'images/teams/bravo.png',
            charlie: 'images/teams/charlie.png',
            delta: 'images/teams/delta.png'
        };

        // 승리 모달 표시
        function showVictoryModal(teamKey) {
            const modal = document.getElementById('victoryModal');
            const teamImage = document.getElementById('victoryTeamImage');
            const teamName = document.getElementById('victoryTeamName');
            const team = tournamentState.teams[teamKey];
            
            // 팀 정보 설정
            teamImage.src = teamImages[teamKey] || 'images/teams/alpha.png';
            teamImage.alt = team.name;
            teamName.textContent = team.name;
            
            // 모달 표시
            modal.classList.add('show');
            
            // 컨페티 애니메이션 시작
            startConfetti();
            
            // 챔피언 섹션도 표시
            showChampion();
            
            // 10초 후 자동 닫기 (클릭으로도 닫기 가능)
            setTimeout(() => {
                closeVictoryModal();
            }, 10000);
            
            // 모달 클릭시 닫기
            modal.onclick = function(event) {
                if (event.target === modal || event.target.classList.contains('victory-modal-content')) {
                    closeVictoryModal();
                }
            };
        }

        // 승리 모달 닫기
        function closeVictoryModal() {
            const modal = document.getElementById('victoryModal');
            modal.classList.remove('show');
            stopConfetti();
        }

        // 챔피언 표시 (기존 기능 유지)
        function showChampion() {
            const championSection = document.getElementById('championSection');
            const championTeam = document.getElementById('championTeam');
            
            if (tournamentState.champion) {
                championSection.classList.add('show');
                championTeam.textContent = tournamentState.teams[tournamentState.champion].name;
            }
        }

        // 컨페티 애니메이션 변수
        let confettiAnimationId;
        let confettiParticles = [];

        // 컨페티 파티클 클래스
        class ConfettiParticle {
            constructor(canvas) {
                this.canvas = canvas;
                this.x = Math.random() * canvas.width;
                this.y = -10;
                this.velocity = {
                    x: (Math.random() - 0.5) * 6,
                    y: Math.random() * 3 + 2
                };
                this.size = Math.random() * 8 + 4;
                this.color = this.getRandomColor();
                this.rotation = Math.random() * 360;
                this.rotationSpeed = (Math.random() - 0.5) * 10;
            }

            getRandomColor() {
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#ff4d6d', '#c77dff', '#ffd700', '#ff00ff', '#00ff00', '#ffff00', '#ff8c00', '#1e90ff'];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            update() {
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.rotation += this.rotationSpeed;
                this.velocity.y += 0.1; // 중력
            }

            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation * Math.PI / 180);
                ctx.fillStyle = this.color;
                ctx.fillRect(-this.size / 2, -this.size / 2, this.size, this.size);
                ctx.restore();
            }

            isOutOfBounds() {
                return this.y > this.canvas.height + 10;
            }
        }

        // 컨페티 애니메이션 시작
        function startConfetti() {
            const canvas = document.getElementById('confettiCanvas');
            const ctx = canvas.getContext('2d');
            
            // 캔버스 크기 설정
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            confettiParticles = [];
            
            // 애니메이션 루프
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // 새 파티클 생성 (더 많은 파티클)
                if (Math.random() < 0.5) {
                    confettiParticles.push(new ConfettiParticle(canvas));
                    confettiParticles.push(new ConfettiParticle(canvas));
                }
                
                // 파티클 업데이트 및 그리기
                confettiParticles = confettiParticles.filter(particle => {
                    particle.update();
                    particle.draw(ctx);
                    return !particle.isOutOfBounds();
                });
                
                confettiAnimationId = requestAnimationFrame(animate);
            }
            
            animate();
            
            // 3초 후 새 파티클 생성 중단
            setTimeout(() => {
                stopConfetti();
            }, 3000);
        }

        // 컨페티 애니메이션 중단
        function stopConfetti() {
            if (confettiAnimationId) {
                cancelAnimationFrame(confettiAnimationId);
                confettiAnimationId = null;
            }
            
            // 캔버스 정리
            const canvas = document.getElementById('confettiCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            confettiParticles = [];
        }

        // 윈도우 리사이즈 시 캔버스 크기 조정
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('confettiCanvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // 토너먼트 초기화
        function resetTournament() {
            if (confirm('정말로 토너먼트를 초기화하시겠습니까? 모든 경기 기록이 삭제됩니다.')) {
                localStorage.removeItem('tournamentState');
                location.reload();
            }
        }

        // 결과 내보내기
        function exportResults() {
            const results = {
                tournament: 'VR CST 더블 엘리미네이션',
                date: new Date().toLocaleDateString('ko-KR'),
                teams: tournamentState.teams,
                matches: tournamentState.matches,
                champion: tournamentState.champion
            };

            const dataStr = JSON.stringify(results, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportFileDefaultName = `vrcst_tournament_${Date.now()}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // 페이지 로드시 초기화
        window.onload = function() {
            loadState();
        };
    </script>
</body>
</html>